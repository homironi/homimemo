---
import Icon from "@/components/Icon.astro";
import type { ArticleMeta } from "@/schemas/article/meta";

interface YearArchive {
  year: number;
  count: number;
};

/**
 * ArchiveComponent用のデータを作成する
 * @param articles 記事
 * @returns ArchiveComponent用のデータ
 */
export function createArchiveByYear(articles: ArticleMeta[]): YearArchive[]{
  const archive  =  articles.reduce((acc, current)=>{
    const year = current.publishDate.getFullYear();
    acc.set(year, (acc.get(year) || 0) + 1);
    return acc;
  }, new Map<number, number>());
  
  return Array.from(archive)
    .map<YearArchive>(entry => ({year: entry[0], count: entry[1] }))
    .sort((a, b) => b.year - a.year);
};

interface Props {
  archive: YearArchive[];
};

const { archive } = Astro.props;
---

<div class="container">
  {archive.map(yearData => (
    <a  class="year-container" href={ `/stats/${yearData.year}/` }>
      <Icon name="homironiRoundStar" class="icon" />
      <div class="text-container">
        <p>{yearData.year}</p>
        <p>{yearData.count}</p>
      </div>
    </a>
  ))}
</div>

<style>
  .container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .year-container {
    position: relative;
    text-align: center;
    width: 6em;
    height: 6em;
    transition: transform 0.3s;
  }

  .year-container:hover {
    transform: scale(1.1);
  }

  .icon {
    color: var(--color-sub);
    width: 100%;
    height: 100%;
  }

  .text-container {
    position: absolute;
    top: 24px;
    width: 100%;
    font-weight: bold;
    color: var(--text-color-white);
  }

  .text-container > :global(p) {
    margin: 0;
  }
</style>
