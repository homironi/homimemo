---
id: 1rzo1xgl9sna9y2apleb8of4
title: Cloudflare Workersでリダイレクトを設定をする
draft: false
publishDate: 2025-09-11T10:54:00.000Z
lastModDate: 2025-09-11T10:54:00.000Z
category: Web制作
tags:
  - Cloudflare
thumbnail: /images/header/articles/1rzo1xgl9sna9y2apleb8of4.webp
description: >-
  当サイトをレンタルサーバーからCloudflare
  Workersへ移行した際に、レンタルサーバーで設定していたリダイレクトを設定しました。その時のメモです。
---
## 環境

- Next.js（SSG）：15.5.2
  - SSGなのでCloudflare側では特にNext.jsを動かすための環境は用意していません
- Cloudflare

## 静的アセットの設定

今回のサイトはSSGなので、静的アセットの配信が必要でした。  
これは設定ファイル`wrangler.jsonc`で簡単に設定できます。  
Next.jsで`/_public/`に出力されるように設定しているので、その場所に静的アセットがありますよー、と設定するだけです。

```json
{
  "name": "homimemo",
  "assets": {
    "directory": "./_public/",
  },
}
```

https://developers.cloudflare.com/workers/static-assets/routing/static-site-generation/

<TextBlock blockType="note">
Next.js側では以下のように設定して、`_public`フォルダに出力されるようにしています。
```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: "export",
  distDir: "_public",
};

export default nextConfig;

```
</TextBlock>

### 末尾スラッシュなし→スラッシュありにリダイレクト

静的アセットの設定として`wrangler.jsonc`のConfigファイルで設定しました。  
`"assets"`の中で`"html_handling": "auto-trailing-slash"`を設定するだけです。  
これでローカルのpreviewをしてみてもリダイレクトされるようになります。

```json
{
  "name": "homimemo",
  "assets": {
    "directory": "./_public/",
    "html_handling": "auto-trailing-slash"
  },
}
```

https://developers.cloudflare.com/workers/static-assets/routing/advanced/html-handling/

## Cloudflareのダッシュボードでリダイレクト設定

先に画像を貼っておきます。  
Cloudflareのダッシュボードから設定することができます！  

![Cloudflareのダッシュボードのルールから設定するスクショ](/images/article/1rzo1xgl9sna9y2apleb8of4/cloudflare_rule.webp)

<TextBlock blockType="info">
今回は特定のURLのリダイレクトはダッシュボードからは設定しませんでしたが（後述）、  ダッシュボードからも設定可能です。  
他にも特定の規則に従ってまとめてリダイレクトを設定することもできます。  
ルールのテンプレートだけでもいろいろあるので確認してみるのもおすすめです！
</TextBlock>

### http→httpsへのリダイレクト

Cloudflareのダッシュボードから設定できます。

1. CloudFlareダッシュボード（アカウントホーム）
2. 該当のドメインを選択
3. ルール  
「＋ルールの作成」の隣にあります
4. テンプレート
5. HTTP から HTTPS へのリダイレクト [テンプレート]

### 末尾/なし→末尾/ありへのリダイレクト

こちらもCloudflareのダッシュボードから設定できます！

1. CloudFlareダッシュボード（アカウントホーム）
2. ドメインを選択
3. ルール
4. テンプレート
5. WWW からルートにリダイレクト [テンプレート]

## 特定のページのリダイレクト

```json
{
  "name": "homimemo",
  "assets": {
    "directory": "./_public/",
    // 手動でリダイレクトしている場所があるのでnoneにすることでリダイレクトしたいものをASSETSが404を先に返してしまわないようにする
    "not_found_handling": "none",
    "html_handling": "auto-trailing-slash"
  },
}
```

## 関連

https://developers.cloudflare.com/workers/static-assets/routing/static-site-generation/

https://developers.cloudflare.com/workers/static-assets/routing/advanced/html-handling/
